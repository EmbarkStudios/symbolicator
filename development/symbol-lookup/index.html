<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  <link rel="shortcut icon" href="../../img/favicon.ico">
  <title>Lookup Strategy - Symbolicator</title>
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">
  
  <script>
    // Current page data
    var mkdocs_page_name = "Lookup Strategy";
    var mkdocs_page_input_path = "development/symbol-lookup.md";
    var mkdocs_page_url = null;
  </script>
  
  <script src="../../js/jquery-2.1.1.min.js" defer></script>
  <script src="../../js/modernizr-2.8.3.min.js" defer></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script> 
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href="../.." class="icon icon-home"> Symbolicator</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
	<ul class="current">
	  
          
            <li class="toctree-l1">
		
    <a class="" href="../..">Home</a>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Advanced</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../advanced/caching/">Caching</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Api</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../api/applecrashreport/">Apple Crash Report</a>
                </li>
                <li class="">
                    
    <a class="" href="../../api/minidump/">Minidump</a>
                </li>
                <li class="">
                    
    <a class="" href="../../api/overview/">Overview</a>
                </li>
                <li class="">
                    
    <a class="" href="../../api/proxy/">Proxy</a>
                </li>
                <li class="">
                    
    <a class="" href="../../api/response/">Response</a>
                </li>
                <li class="">
                    
    <a class="" href="../../api/symbolication/">Symbolication</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Development</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../background-and-principles/">Background and Principles</a>
                </li>
                <li class=" current">
                    
    <a class="current" href="./">Lookup Strategy</a>
    <ul class="subnav">
            
    <li class="toctree-l3"><a href="#lookup-strategy">Lookup Strategy</a></li>
    
        <ul>
        
            <li><a class="toctree-l4" href="#identifiers">Identifiers</a></li>
        
            <li><a class="toctree-l4" href="#symbol-precedence">Symbol Precedence</a></li>
        
            <li><a class="toctree-l4" href="#conversion-algorithms">Conversion Algorithms</a></li>
        
        </ul>
    

    </ul>
                </li>
                <li class="">
                    
    <a class="" href="../symbol-server-compatibility/">Symbol Server Compatibility</a>
                </li>
                <li class="">
                    
    <a class="" href="../system-architecture/">System Architecture</a>
                </li>
    </ul>
	    </li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../..">Symbolicator</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../..">Docs</a> &raquo;</li>
    
      
        
          <li>Development &raquo;</li>
        
      
    
    <li>Lookup Strategy</li>
    <li class="wy-breadcrumbs-aside">
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h1 id="lookup-strategy">Lookup Strategy</h1>
<p>Symbolicator queries a list of external sources for debug information files
which it uses to process minidumps and symbolicate stack traces. Based on
availability, the CPU architecture and the operating system, it may determine
the "best" file to use:</p>
<ol>
<li>Compute the code and debug identifiers for the modules to load.</li>
<li>Look up available files in all sources</li>
<li>Choose the best available file</li>
</ol>
<h2 id="identifiers">Identifiers</h2>
<p>Symbol servers use native identifiers to locate files. Usually, they put them in
a directory hierarchy for easier retrieval.</p>
<p>There are two kinds of identifiers:</p>
<ul>
<li><strong>Code Id:</strong> Native identifier of the actual binary (library or executable).
  Usually, this is a value stored in the header or computed from its contents.</li>
<li><strong>Debug Id:</strong> Identifier of the associated debug file on some platforms, or a
  mangled version of the code identifier on other platforms.</li>
</ul>
<p>To look up different symbol kinds, the symbol server uses the following process
to determine the ID (see below for exact conversion algorithms):</p>
<ul>
<li><strong>MachO:</strong> Use the UUID which is stored interchangeably in <code>debug_id</code> and
  <code>code_id</code>. If one of these values is missing, it can be computed from the
  other. Primarily, the <code>code_id</code> should be used.</li>
<li><strong>ELF:</strong> Use the GNU build id which is given in the <code>code_id</code>. The <code>debug_id</code>
  can be computed from this <code>code_id</code>, but not the other way around. Thus, if
  the <code>code_id</code> is missing, lookups may not be possible.</li>
<li><strong>PE</strong>: Windows executables use a combination of timestamp and size fields to
  compute a <code>code_id</code>. It is mandatory, as it cannot be derived from the
  <code>debug_id</code>.</li>
<li><strong>PDB</strong>: Windows PDBs have their own <code>debug_id</code>, which can be read from the
  PDB or PE header. It is mandatory, as it cannot be derived from the <code>code_id</code>.</li>
<li><strong>Breakpad</strong>: Google Breakpad uses <code>debug_id</code> for all symbol kinds. If it is
  missing, it can be computed from the <code>code_id</code> if this is possible using the
  above rules.</li>
</ul>
<h2 id="symbol-precedence">Symbol Precedence</h2>
<p>Depending on the desired information and type of image, the Symbolicator
requests several files and chooses the best one. Note that the image type
depends on the platform, but there are multiple formats for debug information
files available.</p>
<p>The following is a table of what we initially deemed as ideal lookup strategy.
How we deviate from this in practice is documented separately.</p>
<h3 id="symbol-table">Symbol Table</h3>
<table>
<thead>
<tr>
<th>Platform</th>
<th>1. Choice</th>
<th>2. Choice</th>
<th>3. Choice</th>
</tr>
</thead>
<tbody>
<tr>
<td>MachO</td>
<td>MachO (dSYM)</td>
<td>MachO (code)</td>
<td>Breakpad</td>
</tr>
<tr>
<td>ELF</td>
<td>ELF (debug)</td>
<td>ELF (code)</td>
<td>Breakpad</td>
</tr>
<tr>
<td>PE</td>
<td>PDB</td>
<td>PE</td>
<td>Breakpad</td>
</tr>
</tbody>
</table>
<h3 id="debug-information">Debug Information</h3>
<table>
<thead>
<tr>
<th>Platform</th>
<th>1. Choice</th>
<th>2. Choice</th>
<th>3. Choice</th>
</tr>
</thead>
<tbody>
<tr>
<td>MachO</td>
<td>MachO (dSYM)</td>
<td>Breakpad</td>
<td></td>
</tr>
<tr>
<td>ELF</td>
<td>ELF (debug)</td>
<td>ELF (code)</td>
<td>Breakpad</td>
</tr>
<tr>
<td>PE</td>
<td>PDB</td>
<td>Breakpad</td>
<td></td>
</tr>
</tbody>
</table>
<h3 id="unwind-information">Unwind Information</h3>
<table>
<thead>
<tr>
<th>Platform</th>
<th>1. Choice</th>
<th>2. Choice</th>
</tr>
</thead>
<tbody>
<tr>
<td>MachO</td>
<td>MachO (code)</td>
<td>Breakpad</td>
</tr>
<tr>
<td>ELF</td>
<td>ELF (code)</td>
<td>Breakpad</td>
</tr>
<tr>
<td>PE (32-bit)</td>
<td>PDB</td>
<td>Breakpad</td>
</tr>
<tr>
<td>PE (64-bit)</td>
<td>PE</td>
<td>Breakpad</td>
</tr>
</tbody>
</table>
<h3 id="implementation-notes">Implementation Notes</h3>
<ul>
<li>Symbolicator downloads <em>all</em> filetypes in parallel and filters by whether
  symbolic says that a file has debug/unwind information. There is no special
  codepath for each table presented here, and especially not for each
  platform/filetype.</li>
</ul>
<p>This creates a few more downloads than what would be necessary for a specific
  task, but those should not matter considering that you e.g. will likely look
  into debug information very soon if you already look for unwind information.</p>
<ul>
<li>As a result of the previous point, Symbolicator does not differentiate between
  32-bit and 64-bit platforms, meaning that even on 64-bit Windows it will
  attempt to look into the PDB to find relevant information. Again this should
  not matter in terms of correctness as it will still also unconditionally look
  into the PE and pick that if it's deemed to be be of better quality.</li>
</ul>
<h2 id="conversion-algorithms">Conversion Algorithms</h2>
<p>Some identifiers may be computed from others. See the following list for allowed
non-lossy conversions in pseudocode:</p>
<ul>
<li>
<p><strong>MachO</strong>: <code>code_id</code> ←→ <code>debug_id</code>. Symbolicator implements this by using the
  code ID everywhere.</p>
</li>
<li>
<p><strong>ELF</strong>: <code>code_id</code> → <code>debug_id</code>. This is not yet implemented.</p>
<pre><code>debug_id = code_id[0..16]

if object.little_endian {
  debug_id[0..4].reverse(); // uuid field 1
  debug_id[4..6].reverse(); // uuid field 2
  debug_id[6..8].reverse(); // uuid field 3
}
</code></pre>
</li>
</ul>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../symbol-server-compatibility/" class="btn btn-neutral float-right" title="Symbol Server Compatibility">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../background-and-principles/" class="btn btn-neutral" title="Background and Principles"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
      
        <span><a href="../background-and-principles/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../symbol-server-compatibility/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>
    <script>var base_url = '../..';</script>
    <script src="../../js/theme.js" defer></script>
      <script src="../../search/main.js" defer></script>

</body>
</html>
