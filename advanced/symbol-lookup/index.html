



<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
      
      
        <meta name="author" content="Sentry">
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-4.6.0">
    
    
      
        <title>Lookup Strategy - Sentry Symbolicator</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/application.1b62728e.css">
      
      
    
    
      <script src="../../assets/javascripts/modernizr.268332fc.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../../assets/fonts/material-icons.css">
    
    
      <link rel="stylesheet" href="../../_css/extra.css">
    
    
      
    
    
  </head>
  
    <body dir="ltr">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448" viewBox="0 0 416 448" id="__github"><path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#lookup-strategy" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="../.." title="Sentry Symbolicator" class="md-header-nav__button md-logo">
          
            <img src="../../static/icon.png" width="24" height="24">
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            <span class="md-header-nav__topic">
              Sentry Symbolicator
            </span>
            <span class="md-header-nav__topic">
              
                Lookup Strategy
              
            </span>
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
          
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  

<a href="https://github.com/getsentry/symbolicator/" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    GitHub
  </div>
</a>
          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main" role="main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="../.." title="Sentry Symbolicator" class="md-nav__button md-logo">
      
        <img src="../../static/icon.png" width="48" height="48">
      
    </a>
    Sentry Symbolicator
  </label>
  
    <div class="md-nav__source">
      


  

<a href="https://github.com/getsentry/symbolicator/" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../.." title="Introduction" class="md-nav__link">
      Introduction
    </a>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2" checked>
    
    <label class="md-nav__link" for="nav-2">
      Advanced
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        Advanced
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../background-and-principles/" title="Background and Principles" class="md-nav__link">
      Background and Principles
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../system-architecture/" title="System Architecture" class="md-nav__link">
      System Architecture
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../caching/" title="Caching" class="md-nav__link">
      Caching
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Lookup Strategy
      </label>
    
    <a href="./" title="Lookup Strategy" class="md-nav__link md-nav__link--active">
      Lookup Strategy
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#identifiers" class="md-nav__link">
    Identifiers
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#symbol-precedence" class="md-nav__link">
    Symbol Precedence
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#symbol-table" class="md-nav__link">
    Symbol Table
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#debug-information" class="md-nav__link">
    Debug Information
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#unwind-information" class="md-nav__link">
    Unwind Information
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#implementation-notes" class="md-nav__link">
    Implementation Notes
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#conversion-algorithms" class="md-nav__link">
    Conversion Algorithms
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../symbol-server-compatibility/" title="Symbol Server Compatibility" class="md-nav__link">
      Symbol Server Compatibility
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3">
    
    <label class="md-nav__link" for="nav-3">
      API
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        API
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../api/" title="Overview" class="md-nav__link">
      Overview
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../api/minidump/" title="POST /minidump" class="md-nav__link">
      POST /minidump
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../api/symbolication/" title="POST /symbolicate" class="md-nav__link">
      POST /symbolicate
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../api/applecrashreport/" title="POST /applecrashreport" class="md-nav__link">
      POST /applecrashreport
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../api/response/" title="Symbolication Response" class="md-nav__link">
      Symbolication Response
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../api/proxy/" title="Symbol Server Proxy" class="md-nav__link">
      Symbol Server Proxy
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#identifiers" class="md-nav__link">
    Identifiers
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#symbol-precedence" class="md-nav__link">
    Symbol Precedence
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#symbol-table" class="md-nav__link">
    Symbol Table
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#debug-information" class="md-nav__link">
    Debug Information
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#unwind-information" class="md-nav__link">
    Unwind Information
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#implementation-notes" class="md-nav__link">
    Implementation Notes
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#conversion-algorithms" class="md-nav__link">
    Conversion Algorithms
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/getsentry/symbolicator/edit/master/docs/advanced/symbol-lookup.md" title="Edit this page" class="md-icon md-content__icon">&#xE3C9;</a>
                
                
                <h1 id="lookup-strategy">Lookup Strategy</h1>
<p>Symbolicator queries a list of external sources for debug information files
which it uses to process minidumps and symbolicate stack traces. Based on
availability, the CPU architecture and the operating system, it may determine
the "best" file to use:</p>
<ol>
<li>Compute the code and debug identifiers for the modules to load.</li>
<li>Look up available files in all sources</li>
<li>Choose the best available file</li>
</ol>
<h2 id="identifiers">Identifiers</h2>
<p>Symbol servers use native identifiers to locate files. Usually, they put them in
a directory hierarchy for easier retrieval.</p>
<p>There are two kinds of identifiers:</p>
<ul>
<li><strong>Code Id:</strong> Native identifier of the actual binary (library or executable).
  Usually, this is a value stored in the header or computed from its contents.</li>
<li><strong>Debug Id:</strong> Identifier of the associated debug file on some platforms, or a
  mangled version of the code identifier on other platforms.</li>
</ul>
<p>To look up different symbol kinds, the symbol server uses the following process
to determine the ID (see below for exact conversion algorithms):</p>
<ul>
<li><strong>MachO:</strong> Use the UUID which is stored interchangeably in <code>debug_id</code> and
  <code>code_id</code>. If one of these values is missing, it can be computed from the
  other. Primarily, the <code>code_id</code> should be used.</li>
<li><strong>ELF:</strong> Use the GNU build id which is given in the <code>code_id</code>. The <code>debug_id</code>
  can be computed from this <code>code_id</code>, but not the other way around. Thus, if
  the <code>code_id</code> is missing, lookups may not be possible.</li>
<li><strong>PE</strong>: Windows executables use a combination of timestamp and size fields to
  compute a <code>code_id</code>. It is mandatory, as it cannot be derived from the
  <code>debug_id</code>.</li>
<li><strong>PDB</strong>: Windows PDBs have their own <code>debug_id</code>, which can be read from the
  PDB or PE header. It is mandatory, as it cannot be derived from the <code>code_id</code>.</li>
<li><strong>Breakpad</strong>: Google Breakpad uses <code>debug_id</code> for all symbol kinds. If it is
  missing, it can be computed from the <code>code_id</code> if this is possible using the
  above rules.</li>
</ul>
<h2 id="symbol-precedence">Symbol Precedence</h2>
<p>Depending on the desired information and type of image, the Symbolicator
requests several files and chooses the best one. Note that the image type
depends on the platform, but there are multiple formats for debug information
files available.</p>
<p>The following is a table of what we initially deemed as ideal lookup strategy.
How we deviate from this in practice is documented separately.</p>
<h3 id="symbol-table">Symbol Table</h3>
<table>
<thead>
<tr>
<th>Platform</th>
<th>1. Choice</th>
<th>2. Choice</th>
<th>3. Choice</th>
</tr>
</thead>
<tbody>
<tr>
<td>MachO</td>
<td>MachO (dSYM)</td>
<td>MachO (code)</td>
<td>Breakpad</td>
</tr>
<tr>
<td>ELF</td>
<td>ELF (debug)</td>
<td>ELF (code)</td>
<td>Breakpad</td>
</tr>
<tr>
<td>PE</td>
<td>PDB</td>
<td>PE</td>
<td>Breakpad</td>
</tr>
</tbody>
</table>
<h3 id="debug-information">Debug Information</h3>
<table>
<thead>
<tr>
<th>Platform</th>
<th>1. Choice</th>
<th>2. Choice</th>
<th>3. Choice</th>
</tr>
</thead>
<tbody>
<tr>
<td>MachO</td>
<td>MachO (dSYM)</td>
<td>Breakpad</td>
<td></td>
</tr>
<tr>
<td>ELF</td>
<td>ELF (debug)</td>
<td>ELF (code)</td>
<td>Breakpad</td>
</tr>
<tr>
<td>PE</td>
<td>PDB</td>
<td>Breakpad</td>
<td></td>
</tr>
</tbody>
</table>
<h3 id="unwind-information">Unwind Information</h3>
<table>
<thead>
<tr>
<th>Platform</th>
<th>1. Choice</th>
<th>2. Choice</th>
</tr>
</thead>
<tbody>
<tr>
<td>MachO</td>
<td>MachO (code)</td>
<td>Breakpad</td>
</tr>
<tr>
<td>ELF</td>
<td>ELF (code)</td>
<td>Breakpad</td>
</tr>
<tr>
<td>PE (32-bit)</td>
<td>PDB</td>
<td>Breakpad</td>
</tr>
<tr>
<td>PE (64-bit)</td>
<td>PE</td>
<td>Breakpad</td>
</tr>
</tbody>
</table>
<h3 id="implementation-notes">Implementation Notes</h3>
<ul>
<li>Symbolicator downloads <em>all</em> filetypes in parallel and filters by whether
  symbolic says that a file has debug/unwind information. There is no special
  codepath for each table presented here, and especially not for each
  platform/filetype.</li>
</ul>
<p>This creates a few more downloads than what would be necessary for a specific
  task, but those should not matter considering that you e.g. will likely look
  into debug information very soon if you already look for unwind information.</p>
<ul>
<li>As a result of the previous point, Symbolicator does not differentiate between
  32-bit and 64-bit platforms, meaning that even on 64-bit Windows it will
  attempt to look into the PDB to find relevant information. Again this should
  not matter in terms of correctness as it will still also unconditionally look
  into the PE and pick that if it's deemed to be be of better quality.</li>
</ul>
<h2 id="conversion-algorithms">Conversion Algorithms</h2>
<p>Some identifiers may be computed from others. See the following list for allowed
non-lossy conversions in pseudocode:</p>
<ul>
<li>
<p><strong>MachO</strong>: <code>code_id</code> ←→ <code>debug_id</code>. Symbolicator implements this by using the
  code ID everywhere.</p>
</li>
<li>
<p><strong>ELF</strong>: <code>code_id</code> → <code>debug_id</code>. This is not yet implemented.</p>
<div class="codehilite"><pre><span></span><span class="n">debug_id</span> <span class="o">=</span> <span class="n">code_id</span><span class="p">[</span><span class="mi">0</span><span class="p">..</span><span class="mi">16</span><span class="p">]</span>

<span class="k">if</span> <span class="k">object</span><span class="p">.</span><span class="n">little_endian</span> <span class="err">{</span>
  <span class="n">debug_id</span><span class="p">[</span><span class="mi">0</span><span class="p">..</span><span class="mi">4</span><span class="p">].</span><span class="n">reverse</span><span class="p">();</span> <span class="o">//</span> <span class="n">uuid</span> <span class="n">field</span> <span class="mi">1</span>
  <span class="n">debug_id</span><span class="p">[</span><span class="mi">4</span><span class="p">..</span><span class="mi">6</span><span class="p">].</span><span class="n">reverse</span><span class="p">();</span> <span class="o">//</span> <span class="n">uuid</span> <span class="n">field</span> <span class="mi">2</span>
  <span class="n">debug_id</span><span class="p">[</span><span class="mi">6</span><span class="p">..</span><span class="mi">8</span><span class="p">].</span><span class="n">reverse</span><span class="p">();</span> <span class="o">//</span> <span class="n">uuid</span> <span class="n">field</span> <span class="mi">3</span>
<span class="err">}</span>
</pre></div>


</li>
</ul>
                
                  
                
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../caching/" title="Caching" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Caching
              </span>
            </div>
          </a>
        
        
          <a href="../symbol-server-compatibility/" title="Symbol Server Compatibility" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Symbol Server Compatibility
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../assets/javascripts/application.808e90bb.js"></script>
      
      <script>app.initialize({version:"1.0.4",url:{base:"../.."}})</script>
      
    
  </body>
</html>