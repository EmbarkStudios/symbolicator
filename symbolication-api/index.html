<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  <link rel="shortcut icon" href="../img/favicon.ico">
  <title>Symbolication API - Symbolicator</title>
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">
  
  <script>
    // Current page data
    var mkdocs_page_name = "Symbolication API";
    var mkdocs_page_input_path = "symbolication-api.md";
    var mkdocs_page_url = null;
  </script>
  
  <script src="../js/jquery-2.1.1.min.js" defer></script>
  <script src="../js/modernizr-2.8.3.min.js" defer></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script> 
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href=".." class="icon icon-home"> Symbolicator</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
	<ul class="current">
	  
          
            <li class="toctree-l1">
		
    <a class="" href="..">Symbolicator</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../background-and-principles/">Background and Principles</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../caching/">Internal Caching</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../symbol-lookup/">Symbol lookup strategy</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../symbol-server-compatibility/">Symbol Server Compatibility</a>
	    </li>
          
            <li class="toctree-l1 current">
		
    <a class="current" href="./">Symbolication API</a>
    <ul class="subnav">
            
    <li class="toctree-l2"><a href="#symbolication-api">Symbolication API</a></li>
    
        <ul>
        
            <li><a class="toctree-l3" href="#symbolication-request">Symbolication Request</a></li>
        
            <li><a class="toctree-l3" href="#minidump-request">Minidump Request</a></li>
        
            <li><a class="toctree-l3" href="#symbolication-response">Symbolication Response</a></li>
        
            <li><a class="toctree-l3" href="#external-sources">External Sources</a></li>
        
        </ul>
    

    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../system-architecture/">System Architecture</a>
	    </li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="..">Symbolicator</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="..">Docs</a> &raquo;</li>
    
      
    
    <li>Symbolication API</li>
    <li class="wy-breadcrumbs-aside">
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h1 id="symbolication-api">Symbolication API</h1>
<p>This page describes the public web API of the <a href="https://www.notion.so/9ce2a7da-ad06-44d0-8563-a963aa9e390f">Native Symbolicator</a>.</p>
<p>Symbolicator exposes a HTTP API to allow symbolication of raw native stack traces and minidumps. All information necessary for symbolication needs to be part of the request, such as external buckets and their auth tokens or full stack traces. There are the following endpoints:</p>
<ul>
<li><code>POST /symbolicate</code>: Symbolicate raw native stacktrace</li>
<li><code>POST /minidump</code>: Symbolicate a minidump and extract information</li>
<li><code>GET /requests/:id</code>: Status update on running symbolication jobs</li>
<li><code>GET /health</code>: System status and health monitoring</li>
</ul>
<h2 id="symbolication-request">Symbolication Request</h2>
<pre><code>POST /symbolicate?timeout=123&amp;scope=123

{
  "signal": 11,
  "sources": [
    {
      "id": "&lt;uuid&gt;",
      "type": "http",
      ... // see "External Buckets"
    },
    ...
  ],
  "threads": [
    {
      "frames": [
        {
          "instruction_addr": "0xfeedbeef" // can also be a number
        },
        ...
      ],
      "registers": {
        "rip": "0xfeedbeef",
        "rsp": "0xfeedface"
      }
    }
  ],
  "modules": [
    {
      "type": "macho",
      "debug_id": "some-debug-id",
      "code_id": "some-debug-id",
      "debug_file": "/path/to/image.so",
      "image_addr": "0xfeedbeef",
      "image_size": "0xbeef"
    },
    ...
  ]
}
</code></pre>
<h3 id="query-parameters">Query Parameters</h3>
<ul>
<li><code>demangle[=true]</code>: Tries to demangle the mangled symbol and puts the result in the <code>"name"</code> field.</li>
<li><code>timeout</code>: If given, a response status of <code>pending</code> might be sent by the server.</li>
<li><code>scope</code>: An optional scope which will be used to isolate cached files from each other</li>
</ul>
<h3 id="request-body">Request Body</h3>
<p>A JSON payload describing the stack traces and code modules for symbolication, as well as external sources to pull symbols from:</p>
<ul>
<li><code>sources</code>: A list of descriptors for internal or external symbol sources. See <em>External Sources</em>.</li>
<li><code>modules</code>: A list of code modules (aka debug images) that were loaded into the process. All attributes other than <code>type</code> are required. The Symbolicator may optimize lookups based on the <code>type</code> if present.
Valid types are <code>macho</code>, <code>pe</code>, <code>elf</code>. Invalid types are silently ignored. The Symbolicator still works if the type is invalid, but less efficiently. However, a schematically valid but <em>wrong</em> type is fatal for finding symbols.</li>
<li><code>threads</code>: A list of process threads to symbolicate.<ul>
<li><code>registers</code>: Optional register values aiding symbolication heuristics. For example, register values may be used to perform correction heuristics on the instruction address of the top frame.</li>
<li><code>frames</code>: A list of frames with addresses. Arbitrary additional properties may be passed with frames, but are discarded.</li>
</ul>
</li>
</ul>
<h3 id="response">Response</h3>
<p>See <em>Symbolication Response</em></p>
<h2 id="minidump-request">Minidump Request</h2>
<pre><code>POST /minidump?timeout=5&amp;scope=123
Content-Type: multipart/form-data; boundary=xxx

--xxx
Content-Disposition: form-data; name="upload_file_minidump"
[binary blob]

--xxx
Content-Disposition: form-data; name="sources"
[
  {
    "id": "&lt;uuid&gt;",
    "type": "http",
    ... // see "External Buckets"
  },
  ...
]
</code></pre>
<h3 id="query-parameters_1">Query Parameters</h3>
<ul>
<li><code>demangle[=true]</code>: Tries to demangle the mangled symbol and puts the result in the <code>"name"</code> field.</li>
<li><code>timeout</code>: If given, a response status of <code>pending</code> might be sent by the server.</li>
<li><code>scope</code>: An optional scope which will be used to isolate cached files from each other</li>
</ul>
<h3 id="request-body_1">Request Body</h3>
<p>A multipart form data body containing the minidump, as well as the external sources to pull symbols from.</p>
<ul>
<li><code>sources</code>: A list of descriptors for internal or external symbol sources. See <em>External Sources</em>.</li>
<li><code>upload_file_minidump</code>: The minidump file to be analyzed.</li>
</ul>
<h3 id="response_1">Response</h3>
<p>See <em>Symbolication Response</em>.</p>
<h2 id="symbolication-response">Symbolication Response</h2>
<p>The response to a symbolication request is a JSON object which contains different data depending on the status of the symbolication job:</p>
<ul>
<li><code>pending</code>: Symbolication has not finished yet. Try again later.</li>
<li><code>complete</code>: The symbolication request has been processed and results are ready. This status is only reported once, after which the job is cleaned up.</li>
<li><code>error</code>: Something went wrong during symbolication, and details are in the payload.</li>
</ul>
<h3 id="success-response">Success Response</h3>
<p>Symbol server responds with <em>200 OK</em> and the response payload listed below if symbolication succeeds within a configured timeframe (around 20 seconds): </p>
<pre><code>{
  "status": "complete",                   // TODO: Describe all status

  // Symbolicated stack traces
  "stacktraces": [
    {                                     // Only frames, no registers
      "frames": [
        {
          // symbolication meta data
          "status": "symbolicated",       // TODO: Describe all statuses
          "original_index": 0,

          // frame information
          "instruction_addr": "0xfeedbeef",
          "package": "/path/to/module.so",
          "function": "memset",           // demangled short version of symbol
          "lang": "cpp",                  // TODO: List all languages
          "symbol": "__1cGmemset6FpviI_0_",
          "sym_addr": "0xfeed0000",
          "filename": "../src/file.c",    // Relative to compilation dir
          "abs_path": "/path/to/src/file.c",
          "lineno": 22,
          "line_addr": "0xfeedbe00",      // This does not exist in Sentry
        },
        ...
      ],
      "registers": { ... }
    }
  ],

  // Modules completed with information read from object files
  "modules": [
    {
      "status": "found", 
      ...
    }
  ],

  // Additional information read from crash report
  "arch": "x86_64",
  "signal": 11,
  "os": {
    "name": "Windows NT",
    "version": "8.1.2700"
  }
}
</code></pre>
<p>The symbolicated frames are returned in the same order as provided in the request. Additional properties passed in the request are discarded. Errors that occurred during symbolication, such as missing symbol files or unresolvable addresses within symbols are reported as values for <code>status</code> in both modules and frames.</p>
<h3 id="backoff-response">Backoff Response</h3>
<p>If symbolication takes longer than the threshold <code>timeout</code>, the server instead responds with a backoff response. It will then continue to fetch symbols and symbolication. The response indicates the estimated time for symbol retrieval, after which the symbolication request can be expected to succeed:</p>
<pre><code>{
  "status": "pending",
  "request_id": "deadbeef",
  "retry_after": 300,   // 5 minutes
}
</code></pre>
<p>The symbolication server must not send a backoff response if no timeout was sent by the client.</p>
<p>Note that the <code>retry_after</code> value is just an estimation and does not give any guarantee. The request may be repeated at any time:</p>
<pre><code>GET /requests/deadbeef?timeout=123
</code></pre>
<h3 id="invalid-request-response">Invalid Request Response</h3>
<p>If the user provided a non-existent request ID, the server responds with <em>404 Not Found</em>.</p>
<p>Requests should always be treated transient as they might disappear during a deploy. Clients must expect that 404 is returned even for valid request IDs and then re-schedule symbolication</p>
<p>On a related note, generally state on the server is ephemeral.</p>
<h2 id="external-sources">External Sources</h2>
<p>The service loads symbol files from external buckets as specified in the symbolication request. Access to these buckets may occur via one of the following protocols.</p>
<p>Refer to <code>README.md</code> for the possible source types.</p>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../system-architecture/" class="btn btn-neutral float-right" title="System Architecture">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../symbol-server-compatibility/" class="btn btn-neutral" title="Symbol Server Compatibility"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
      
        <span><a href="../symbol-server-compatibility/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../system-architecture/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>
    <script>var base_url = '..';</script>
    <script src="../js/theme.js" defer></script>
      <script src="../search/main.js" defer></script>

</body>
</html>
