<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  <link rel="shortcut icon" href="../../img/favicon.ico">
  <title>Symbol Server Compatibility - Symbolicator</title>
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">
  
  <script>
    // Current page data
    var mkdocs_page_name = "Symbol Server Compatibility";
    var mkdocs_page_input_path = "development/symbol-server-compatibility.md";
    var mkdocs_page_url = null;
  </script>
  
  <script src="../../js/jquery-2.1.1.min.js" defer></script>
  <script src="../../js/modernizr-2.8.3.min.js" defer></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script> 
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href="../.." class="icon icon-home"> Symbolicator</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
	<ul class="current">
	  
          
            <li class="toctree-l1">
		
    <a class="" href="../..">Home</a>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Advanced</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../advanced/caching/">Caching</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Api</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../api/applecrashreport/">Apple Crash Report</a>
                </li>
                <li class="">
                    
    <a class="" href="../../api/minidump/">Minidump</a>
                </li>
                <li class="">
                    
    <a class="" href="../../api/overview/">Overview</a>
                </li>
                <li class="">
                    
    <a class="" href="../../api/proxy/">Proxy</a>
                </li>
                <li class="">
                    
    <a class="" href="../../api/response/">Response</a>
                </li>
                <li class="">
                    
    <a class="" href="../../api/symbolication/">Symbolication</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Development</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../background-and-principles/">Background and Principles</a>
                </li>
                <li class="">
                    
    <a class="" href="../symbol-lookup/">Lookup Strategy</a>
                </li>
                <li class=" current">
                    
    <a class="current" href="./">Symbol Server Compatibility</a>
    <ul class="subnav">
            
    <li class="toctree-l3"><a href="#symbol-server-compatibility">Symbol Server Compatibility</a></li>
    
        <ul>
        
            <li><a class="toctree-l4" href="#prerequisites">Prerequisites</a></li>
        
            <li><a class="toctree-l4" href="#supported-servers">Supported Servers</a></li>
        
            <li><a class="toctree-l4" href="#other-servers">Other Servers</a></li>
        
        </ul>
    

    </ul>
                </li>
                <li class="">
                    
    <a class="" href="../system-architecture/">System Architecture</a>
                </li>
    </ul>
	    </li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../..">Symbolicator</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../..">Docs</a> &raquo;</li>
    
      
        
          <li>Development &raquo;</li>
        
      
    
    <li>Symbol Server Compatibility</li>
    <li class="wy-breadcrumbs-aside">
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h1 id="symbol-server-compatibility">Symbol Server Compatibility</h1>
<p>This page describes external sources supported by Symbolicator.</p>
<p>The layout of external sources intends to be compatible to several symbol server
implementations that have been used historically by different platforms. We
commit to provide compatibility to the following services or directory
structures:</p>
<ul>
<li>Microsoft Symbol Server</li>
<li>Breakpad Symbol Repositories</li>
<li>LLDB File Mapped UUID Directories</li>
<li>GDB Build ID Directories</li>
</ul>
<h2 id="prerequisites">Prerequisites</h2>
<h3 id="identifiers">Identifiers</h3>
<p>There are two fundamentally different identifiers. Their semantics fundamentally
depend on the symbol type, but follow certain rules:</p>
<ul>
<li><strong>Code Identifier:</strong> Identifies the actual executable or library file (e.g.
  EXE or DLL)</li>
<li><strong>Debug Identifier:</strong> Identifies a debug companion file (e.g. PDB)</li>
</ul>
<p>On all platforms other than Windows, binaries and debug companion files use the
same file type and share the same container. The Breakpad library has thus
changed the semantics of those identifiers for all other platforms to:</p>
<ul>
<li><strong>Code Identifier:</strong> The original platform-specific identifier</li>
<li><strong>Debug Identifier:</strong> A potentially lossy transformation of the code
  identifier into a unified format similar to the PDB debug identifiers.</li>
</ul>
<p>Specifically, the code and debug identifiers are defined as follows:</p>
<p><strong>ELF</strong>:</p>
<ul>
<li><strong>Code ID:</strong> The contents of the <code>.note.gnu.build-id</code> section, or if not
  present the value of the <code>NT_GNU_BUILD_ID</code> program header. This value is
  traditionally 20 bytes formatted as hex string (40 characters). If neither
  are present, there is no code id.</li>
<li><strong>Debug ID:</strong> The first 16 bytes of the GNU build id interpreted as
  little-endian GUID. This flips the byte order of the first three components
  in the build ID. An <em>age</em> of <code>0</code> is appended at the end. The remaining bytes
  of the build ID are discarded. This identifier is only specified by
  Breakpad, but by SSQP.</li>
</ul>
<p><strong>MachO</strong>:</p>
<ul>
<li><strong>Code ID:</strong> The UUID as specified in the <code>LC_UUID</code> load command header.
  Breakpad does not save this value explicitly since it can be converted
  bidirectionally from the UUID.</li>
<li><strong>Debug ID:</strong> The same UUID, amended by a <code>0</code> for age.</li>
</ul>
<p><strong>PE</strong> / <strong>PDB</strong>:</p>
<ul>
<li><strong>Code ID:</strong> The hex value of the <code>time_date_stamp</code> in the COFF header
  formatted as <code>%08X</code> followed by <code>size_of_image</code> in the optional header
  formatted as <code>%X</code> (variable length). This value is always read from the PE -
  computing this from a PDB is not possible without locating the according PE.</li>
<li><strong>Debug ID:</strong> The <code>signature</code> and <code>age</code> (<code>%X</code> variable length) fields from
  the debug information stream in the PDB. The fields in the signature GUID
  are converted to network byte order first. This identifier can also be
  computed from a PE by reading the <code>code_view_pdb_70</code> records.</li>
</ul>
<p><strong>Breakpad</strong>:</p>
<ul>
<li><strong>Code ID:</strong> If applicable, Breakpad symbols will contain a <code>INFO CODE_ID</code>
  record in the second line. Otherwise, the code ID is equal to the Debug ID.</li>
<li><strong>Debug ID</strong>: Value of the identifier field in the <code>MODULE</code> record, always
  in the first line of the file.</li>
</ul>
<h3 id="case-sensitivity">Case Sensitivity</h3>
<p>Most symbol servers explicitly define <strong>case insensitive</strong> lookup semantics.
This goes in particular for the Microsoft Public Symbol Server. However, the
canonical representation on the file system is not necessarily case insensitive,
for example when the files are stored on an Amazon S3 bucket. Since this is a
hard restriction, the case for lookups is explicitly defined for each source
below. Please pay attention to the casing rules!</p>
<h3 id="compression">Compression</h3>
<p>Symbolicator supports a range of compression formats (zlib, gzip, zstd and cab).
For cab compression, the <code>cabextract</code> binary needs to be installed. If the debug
file is already compressed, it will be auto-detected and extracted. For PE/PDB
files, Symbolicator also supports the Microsoft convention of replacing the last
character in the filename with an underscore.</p>
<h2 id="supported-servers">Supported Servers</h2>
<h3 id="breakpad">Breakpad</h3>
<p>Breakpad always computes a "Breakpad ID" for each symbol. This is a lossy
process depending on the file type. Sentry stores a bidirectionally compatible
version of this in the <code>debug_id</code> field.</p>
<p>The name of the symbol file is platform dependent. On Windows, the file
extension (Either <em>.exe</em>, <em>.dll</em> or <em>.pdb</em>) is replaced with <em>.sym</em>. On all
other platforms, the <em>.sym</em> extension is <strong>appended</strong> to the full file name
including potential extensions.</p>
<p>Casing rules are mixed:</p>
<ul>
<li>The file name is <strong>as given</strong></li>
<li>The signature part of the id (first 32 characters) are <strong>uppercase</strong></li>
<li>The age part of the id (remaining characters) are <strong>lowercase</strong></li>
</ul>
<p><strong>Schema</strong>: <code>&lt;debug_name&gt;/&lt;breakpad-id&gt;/&lt;sym_name&gt;</code></p>
<h3 id="microsoft-symbol-server">Microsoft Symbol Server</h3>
<p>The public symbol server provided by Microsoft used to only host PDBs for the
Windows platform. These use a <em>signature-age</em> debug identifier in addition to
the file name to locate symbols. For .NET, this specification was amended by a
schema for ELF and MachO-symbols, which is specified as <a href="https://github.com/dotnet/symstore/blob/master/docs/specs/SSQP_Key_Conventions.md">SSQP Key Conventions</a>.
This means all non windows platforms are following SSQP rules except for casing.</p>
<p>Casing rules for Symbol Server are mixed:</p>
<ul>
<li>Filenames are <strong>as given</strong></li>
<li>Identifiers are generally <strong>lowercase</strong>, except:</li>
<li>The signature and age of a PDB identifier is <strong>uppercase</strong>.</li>
<li>The timestamp of a PE identifier is <strong>uppercase</strong> except the size is
  <strong>lowercase</strong></li>
</ul>
<p><strong>Schema</strong>:</p>
<ul>
<li><strong>PE</strong>: <code>&lt;code_name&gt;/&lt;Timestamp&gt;&lt;SizeOfImage&gt;/&lt;code_name&gt;</code></li>
<li><strong>PDB</strong>: <code>&lt;debug_name&gt;/&lt;Signature&gt;&lt;Age&gt;/&lt;debug_name&gt;</code></li>
<li><strong>ELF</strong> (binary, potentially stripped):
  <code>&lt;code_name&gt;/elf-buildid-&lt;note_byte_sequence&gt;/&lt;code_name&gt;</code></li>
<li><strong>ELF</strong> (debug info): <code>_.debug/elf-buildid-sym-&lt;note_byte_sequence&gt;/_.debug</code></li>
<li><strong>MachO</strong> (binary): <code>&lt;code_name&gt;/mach-uuid-&lt;uuid_bytes&gt;/&lt;code_name&gt;</code></li>
<li><strong>MachO</strong> (dSYM): <code>_.dwarf/mach-uuid-sym-&lt;uuid_bytes&gt;/_.dwarf</code></li>
</ul>
<p>The presence of a <code>index2.txt</code> in the root indicates two tier structure where
the first two characters are prepended to the path as an additional folder. So
<code>foo.exe/542D5742000f2000/foo.exe</code> is stored as
<code>fo/foo.exe/542D5742000f2000/foo.exe</code>.</p>
<h3 id="microsoft-ssqp-symbol-server">Microsoft SSQP Symbol Server</h3>
<p>Casing rules for SSQP are mixed:</p>
<ul>
<li>Filenames are <strong>lowercased</strong></li>
<li>Identifiers are generally <strong>lowercase</strong>, except:</li>
<li>
<p>The age of a PDB identifier is <strong>uppercase</strong>.</p>
</li>
<li>
<p><strong>PE</strong>: <code>&lt;code_name&gt;/&lt;Timestamp&gt;&lt;SizeOfImage&gt;/&lt;code_name&gt;</code></p>
</li>
<li><strong>PDB</strong>: <code>&lt;debug_name&gt;/&lt;Signature&gt;&lt;Age&gt;/&lt;debug_name&gt;</code></li>
<li><strong>ELF</strong> (binary, potentially stripped):
  <code>&lt;code_name&gt;/elf-buildid-&lt;note_byte_sequence&gt;/&lt;code_name&gt;</code></li>
<li><strong>ELF</strong> (debug info): <code>_.debug/elf-buildid-sym-&lt;note_byte_sequence&gt;/_.debug</code></li>
<li><strong>MachO</strong> (binary): <code>&lt;code_name&gt;/mach-uuid-&lt;uuid_bytes&gt;/&lt;code_name&gt;</code></li>
<li><strong>MachO</strong> (dSYM): <code>_.dwarf/mach-uuid-sym-&lt;uuid_bytes&gt;/_.dwarf</code></li>
</ul>
<p>Additionally, SSQP supports a lookup by SHA1 checksum over the file contents,
commonly used for source file lookups. This will not be supported.</p>
<h3 id="lldb-debugger-macos">LLDB Debugger (macOS)</h3>
<p>The LLDB debugger on macOS can read debug symbols from <a href="http://lldb.llvm.org/use/symbols.html#file-mapped-uuid-directories">File Mapped UUID
Directories</a> (scroll down to the second last section). The UUID is broken up by
splitting the first 20 hex digits into 4 character chunks, and a directory is
created for each chunk. In the final directory, LLDB usually expects a symlink
named by the last 12 hex digits, which it follows to the actual dSYM file.</p>
<p><strong>Note</strong>: this is not actually an LLVM feature. This is in fact a feature of
<code>CoreFoundation</code> and exclusively implemented on macOS on top of spotlight.
Spotlight indexes these paths and the private <code>DBGCopyFullDSYMURLForUUID</code> API is
used by lldb to locate the symbols. macOS uses the symlinks of those locations.</p>
<p>Since the executable or library shares the same UUID as the dSYM file, the
former are distinguished with a <code>.app</code> suffix.</p>
<p>The hex digits are <strong>uppercase</strong>, the app suffix is <strong>lowercase</strong>.</p>
<ul>
<li><strong>MachO</strong> (binary): <code>XXXX/XXXX/XXXX/XXXX/XXXX/XXXXXXXXXXXX.app</code></li>
<li><strong>MachO</strong> (dSYM): <code>XXXX/XXXX/XXXX/XXXX/XXXX/XXXXXXXXXXXX</code></li>
</ul>
<h3 id="gdb">GDB</h3>
<p><a href="https://sourceware.org/gdb/onlinedocs/gdb/Separate-Debug-Files.html">GDB</a> supports multiple lookup methods, depending on the way the debug info file
is specified. However, not all of these methods are applicable to a symbol
server:</p>
<ul>
<li><strong>Debug Link Method:</strong> GDB looks up the name or relative path specified in the
  <code>.gnu.debuglink</code> section. This requires the debug file to be in a relative
  position to the actual executable, and does not provide any means to
  distinguish by a unique identifier.</li>
<li><strong>Build ID Method:</strong> Assuming that a GNU build ID note or section have been
  written to the ELF file, this specifies a unique identifier for the executable
  which is also retained in the debug file. This method is applicable to a
  symbol server, but only if the Build ID is present.</li>
</ul>
<p>The GNU build ID is a variable-length binary string, usually consisting of a
20-byte SHA1 hash of the code section (<code>.text</code>). The lookup path is
<em>nn/nnnnnnnn.debug</em>, where <em>nn</em> are the first 2 hex characters of the build ID
bit string, and <em>nnnnnnnn</em> are the rest of the bit string. To look up
executables, the <code>.debug</code> suffix is omitted.</p>
<p>The build-id hex representation is always provided in <strong>lowercase</strong>.</p>
<ul>
<li><strong>ELF</strong> (binary, potentially stripped)</li>
<li><strong>ELF</strong> (debug info)</li>
</ul>
<h2 id="other-servers">Other Servers</h2>
<p>The following additional sources were considered but are not implemented right
now:</p>
<h3 id="fedora-darkserver">Fedora Darkserver</h3>
<p>In 2010, Fedora launched a project called "Darkserver" that aimed to provide a
symbol server for various libraries. In 2012, it seemed to have contained
symbols for Debian and Ubuntu as well.</p>
<p>However, this projects seems to have been abandoned since and there is only
little information available. For now, there is no intention to support
Darkserver.</p>
<h3 id="mozilla-tecken">Mozilla Tecken</h3>
<p>Tecken is the symbol server implementation used at Mozilla. The symbol file
paths are compatible to Google's Breakpad symbol server. An example of available
symbols can be viewed at <a href="https://symbols.mozilla.org/downloads/missing">symbols.mozilla.org</a>.</p>
<p>Tecken internally implements a client for the Microsoft Symbol Server to forward
downloads for missing symbols. While doing that, it attempts to replace the last
character in the URL with an underscore to look up compressed symbols. In any
case Tecken tries both variants. Example: <code>foo.exe/&lt;id&gt;/foo.ex_</code>. Microsoft
Symbol Server no longer supports this.</p>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../system-architecture/" class="btn btn-neutral float-right" title="System Architecture">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../symbol-lookup/" class="btn btn-neutral" title="Lookup Strategy"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
      
        <span><a href="../symbol-lookup/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../system-architecture/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>
    <script>var base_url = '../..';</script>
    <script src="../../js/theme.js" defer></script>
      <script src="../../search/main.js" defer></script>

</body>
</html>
