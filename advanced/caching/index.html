



<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
      
      
        <meta name="author" content="Sentry">
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-4.6.0">
    
    
      
        <title>Caching - Sentry Symbolicator</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/application.1b62728e.css">
      
      
    
    
      <script src="../../assets/javascripts/modernizr.268332fc.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../../assets/fonts/material-icons.css">
    
    
      <link rel="stylesheet" href="../../_css/extra.css">
    
    
      
    
    
  </head>
  
    <body dir="ltr">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448" viewBox="0 0 416 448" id="__github"><path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#caching" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="../.." title="Sentry Symbolicator" class="md-header-nav__button md-logo">
          
            <img src="../../static/icon.png" width="24" height="24">
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            <span class="md-header-nav__topic">
              Sentry Symbolicator
            </span>
            <span class="md-header-nav__topic">
              
                Caching
              
            </span>
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
          
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  

<a href="https://github.com/getsentry/symbolicator/" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    GitHub
  </div>
</a>
          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main" role="main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="../.." title="Sentry Symbolicator" class="md-nav__button md-logo">
      
        <img src="../../static/icon.png" width="48" height="48">
      
    </a>
    Sentry Symbolicator
  </label>
  
    <div class="md-nav__source">
      


  

<a href="https://github.com/getsentry/symbolicator/" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../.." title="Introduction" class="md-nav__link">
      Introduction
    </a>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2" checked>
    
    <label class="md-nav__link" for="nav-2">
      Advanced
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        Advanced
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../background-and-principles/" title="Background and Principles" class="md-nav__link">
      Background and Principles
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../system-architecture/" title="System Architecture" class="md-nav__link">
      System Architecture
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Caching
      </label>
    
    <a href="./" title="Caching" class="md-nav__link md-nav__link--active">
      Caching
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#cache-files" class="md-nav__link">
    Cache Files
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cache-rules" class="md-nav__link">
    Cache Rules
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cache-enforcement" class="md-nav__link">
    Cache Enforcement
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#scopes" class="md-nav__link">
    Scopes
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pruning-caches" class="md-nav__link">
    Pruning Caches
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../symbol-lookup/" title="Lookup Strategy" class="md-nav__link">
      Lookup Strategy
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../symbol-server-compatibility/" title="Symbol Server Compatibility" class="md-nav__link">
      Symbol Server Compatibility
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3">
    
    <label class="md-nav__link" for="nav-3">
      API
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        API
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../api/" title="Overview" class="md-nav__link">
      Overview
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../api/minidump/" title="POST /minidump" class="md-nav__link">
      POST /minidump
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../api/symbolication/" title="POST /symbolicate" class="md-nav__link">
      POST /symbolicate
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../api/applecrashreport/" title="POST /applecrashreport" class="md-nav__link">
      POST /applecrashreport
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../api/response/" title="Symbolication Response" class="md-nav__link">
      Symbolication Response
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../api/proxy/" title="Symbol Server Proxy" class="md-nav__link">
      Symbol Server Proxy
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#cache-files" class="md-nav__link">
    Cache Files
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cache-rules" class="md-nav__link">
    Cache Rules
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cache-enforcement" class="md-nav__link">
    Cache Enforcement
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#scopes" class="md-nav__link">
    Scopes
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pruning-caches" class="md-nav__link">
    Pruning Caches
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/getsentry/symbolicator/edit/master/docs/advanced/caching.md" title="Edit this page" class="md-icon md-content__icon">&#xE3C9;</a>
                
                
                <h1 id="caching">Caching</h1>
<p>Conceptionally, Symbolicator does not store debug information files but treats
them as transient caches. Symbolicator caches two types of files: Raw debug
information files and symbolication caches.</p>
<h2 id="cache-files">Cache Files</h2>
<p>Symbolicator caches two kinds of files: original Debug Information Files and
derived caches which comprise SymCaches and CFI caches.</p>
<ul>
<li><strong>Debug Information Files (Object Files)</strong> (original): The original debug
  files as they are stored on external sources. They are cached to allow for
  faster recomputation of the derived caches, especially when after an update
  the format of the derived caches change. Otherwise, all original files would
  have to be downloaded again which could incur significant performance impact.
  DIFs are platform dependent and usually large in size, up to multiple GB.
  Their internal structure is platform dependent.</li>
<li><strong>Object Meta Files</strong> (derived): Important attributes of a Object File used to
  determine which Object File is the best one. This information is persisted
  separately from Object Files because we want to delete Object Files a few days
  after download for disk we want to delete Object Files a few days after
  download for disk space while still knowing some information about them.</li>
<li><strong>Symbolication Caches</strong> (derived): A platform-independent representation of
  function and line information to symbolicate instruction addresses. Those
  files are usually significantly smaller than native DIFs. However, endianness
  of the file contents depends on the host so these files cannot be transferred
  between systems with different endianness.</li>
<li><strong>CFI Caches</strong> (derived): A platform-independent representation of stack
  unwind information to allow stackwalking. This currently uses the Breakpad
  ASCII format.</li>
</ul>
<h2 id="cache-rules">Cache Rules</h2>
<p>In addition to caching DIFs and derived caches, Symbolicator also stores
placeholders to indicate the absence of or errors when retrieving or computing
those files. The cache adheres to the following rules:</p>
<ol>
<li>DIFs are cached until they have not been used for <em>7 days</em> but may be deleted
   earlier when disk space is running out. A DIF is used when a derived cache is
   computed from it.</li>
<li>Derived caches that were successfully created from preferred DIFs are cached
   until they have not been used for <em>at least 7 days</em>.</li>
<li>Derived caches that were successfully created from fallback DIFs are treated
   equally but <em>at most once per hour</em> an upgrade attempt is started to search
   for better DIFs.</li>
<li>The absence of a DIF is cached for <em>1 hour</em>, after that another fetch attempt
   from all sources is started.</li>
<li>Failed conversions (due to malformed or unsupported debug files) are cached
   for <em>24 hours</em> but only up to the <em>next restart</em>. After that, another
   conversion is attempted. The restart constraint serves the purpose to allow
   immediate bug fixes.</li>
</ol>
<p>Derived caches can continue to be stored independently of the DIFs they were
created from. Because they are smaller than the originals, this contributes to a
better use of the available disk space. All timeouts mentioned above are
configurable:</p>
<div class="codehilite"><pre><span></span><span class="n">caches</span><span class="o">:</span>
  <span class="n">downloaded</span><span class="o">:</span>
    <span class="n">max_unused_for</span><span class="o">:</span>
      <span class="n">days</span><span class="o">:</span> <span class="mi">7</span> <span class="err">#</span> <span class="n">unused</span> <span class="n">DIFs</span><span class="o">,</span> <span class="n">rule</span> <span class="mi">1</span>
    <span class="n">retry_misses_after</span><span class="o">:</span>
      <span class="n">hours</span><span class="o">:</span> <span class="mi">1</span> <span class="err">#</span> <span class="n">absence</span> <span class="n">of</span> <span class="n">a</span> <span class="n">DIF</span><span class="o">,</span> <span class="n">rule</span> <span class="mi">4</span>
  <span class="n">derived</span><span class="o">:</span>
    <span class="n">max_unused_for</span><span class="o">:</span>
      <span class="n">days</span><span class="o">:</span> <span class="mi">7</span> <span class="err">#</span> <span class="n">unused</span> <span class="n">caches</span><span class="o">,</span> <span class="n">rule</span> <span class="mi">2</span>
    <span class="n">retry_misses_after</span><span class="o">:</span>
      <span class="n">hours</span><span class="o">:</span> <span class="mi">1</span> <span class="err">#</span> <span class="n">also</span> <span class="n">necessary</span> <span class="k">for</span> <span class="n">rule</span> <span class="mi">4</span>
</pre></div>


<h2 id="cache-enforcement">Cache Enforcement</h2>
<p>In order to enforce the desired cache behavior, Symbolicator uses file system
meta data and information stored in the files themselves to determine when to
evict items from the cache.</p>
<ol>
<li><strong>Last use of derived cache</strong>: The time when a derived cache was last used in
   a symbolication request. This allows to prune cold caches from the system,
   even from an external service. This value is stored in the <em>mtime</em> of the
   symbolication file and updated at most <em>once per hour</em>.</li>
<li><strong>Last attempt to fetch dependencies of a cache:</strong> The time when the a
   derived cache could not be constructed because no debug files were available.
   Instead, a placeholder cache file is created and its <em>mtime</em> indicates the
   attempt. If this file is older than the threshold (default <em>1 hour</em>), another
   fetch attempt can be started and the file is recreated or replaced. <strong>NOTE</strong>:
   The placeholder is created for the derived cache only, because otherwise too
   many placeholders would be created.</li>
<li><strong>Last failed cache conversion</strong>: The time when deriving a cache from a
   native DIF failed due to an error. A placeholder file is created and its
   <em>mtime</em> indicates the attempt. If a file is older than the threshold (default
   <em>24 hours</em>), conversion is repeated. If the debug files have been deleted in
   between, this causes another fetch from external sources.</li>
<li><strong>DIFs used for derived cache</strong>: The kind of debug information that was used
   to compute a derived cache. SymCaches store this in their header, so this can
   be retrieved inexpensively by opening the file. CFI caches currently do not
   contain this information, although all DIFs offer equal quality of unwind
   information.</li>
<li><strong>Last cache upgrade:</strong> The last time when an upgrade of an existing derived
   cache was attempted since it was not computed from a preferred source. This
   also uses the file’s <em>mtime</em> and attempts an update every time the
   modification time exceeds the threshold.</li>
</ol>
<h2 id="scopes">Scopes</h2>
<p>Cached files are associated to a scope, which is given by the symbolication
request. The default is a “global” scope, which implicitly makes the files
accessible to any request (scoped and not scoped). Otherwise, the scope needs to
match for caches to be used. Note that there is no verification of the scope
number, so users of Symbolicator are required to ensure the soundness of scope
values.</p>
<p>Scoping is achieved by encoding the scope identifier into the cache paths, thus
creating separate cache directories for each scope.</p>
<h2 id="pruning-caches">Pruning Caches</h2>
<p>The <code>symbolicator cleanup</code> command removes stale caches. This command needs to
be run manually and periodically, or at least when disk space is about to run
out.</p>
<p>Symbolicator operates under the assumption that files may be removed by an
external actor at any time (one such actor is <code>symbolicator cleanup</code> itself
which does not really attempt to synchronize with the main symbolicator
service).</p>
<p>Symbolicator assumes a fully POSIX-compliant filesystem to be able to serve
requests without interruptions while files are being deleted. <strong>Using a network
share for the cache folder will not work.</strong></p>
                
                  
                
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../system-architecture/" title="System Architecture" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                System Architecture
              </span>
            </div>
          </a>
        
        
          <a href="../symbol-lookup/" title="Lookup Strategy" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Lookup Strategy
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../assets/javascripts/application.808e90bb.js"></script>
      
      <script>app.initialize({version:"1.0.4",url:{base:"../.."}})</script>
      
    
  </body>
</html>