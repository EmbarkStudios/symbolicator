<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  <link rel="shortcut icon" href="../img/favicon.ico">
  <title>Symbol lookup strategy - Symbolicator</title>
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">
  
  <script>
    // Current page data
    var mkdocs_page_name = "Symbol lookup strategy";
    var mkdocs_page_input_path = "symbol-lookup.md";
    var mkdocs_page_url = null;
  </script>
  
  <script src="../js/jquery-2.1.1.min.js" defer></script>
  <script src="../js/modernizr-2.8.3.min.js" defer></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script> 
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href=".." class="icon icon-home"> Symbolicator</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
	<ul class="current">
	  
          
            <li class="toctree-l1">
		
    <a class="" href="..">Symbolicator</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../background-and-principles/">Background and Principles</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../caching/">Internal Caching</a>
	    </li>
          
            <li class="toctree-l1 current">
		
    <a class="current" href="./">Symbol lookup strategy</a>
    <ul class="subnav">
            
    <li class="toctree-l2"><a href="#symbol-lookup-strategy">Symbol lookup strategy</a></li>
    
        <ul>
        
            <li><a class="toctree-l3" href="#identifiers">Identifiers</a></li>
        
            <li><a class="toctree-l3" href="#symbol-precedence">Symbol Precedence</a></li>
        
            <li><a class="toctree-l3" href="#platform-1-choice-2-choice-3-choice">Platform | 1. Choice    | 2. Choice    | 3. Choice</a></li>
        
            <li><a class="toctree-l3" href="#platform-1-choice-2-choice-3-choice_1">Platform | 1. Choice    | 2. Choice    | 3. Choice</a></li>
        
            <li><a class="toctree-l3" href="#platform-1-choice-2-choice">Platform    | 1. Choice    | 2. Choice</a></li>
        
            <li><a class="toctree-l3" href="#conversion-algorithms">Conversion Algorithms</a></li>
        
        </ul>
    

    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../symbol-server-compatibility/">Symbol Server Compatibility</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../symbolication-api/">Symbolication API</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../system-architecture/">System Architecture</a>
	    </li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="..">Symbolicator</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="..">Docs</a> &raquo;</li>
    
      
    
    <li>Symbol lookup strategy</li>
    <li class="wy-breadcrumbs-aside">
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h1 id="symbol-lookup-strategy">Symbol lookup strategy</h1>
<p>This page describes how Symbolicator resolves debug files.</p>
<p>Symbolicator queries a list of external sources for debug information files which it uses to process minidumps and symbolicate stack traces. Based on availability, the CPU architecture and the operating system, it may determine the "best" file to use:</p>
<ol>
<li>Compute the code and debug identifiers for the modules to load.</li>
<li>Look up available files in all sources</li>
<li>Choose the best available file</li>
</ol>
<h2 id="identifiers">Identifiers</h2>
<p>Symbol servers use native identifiers to locate files. Usually, they put them in a directory hierarchy for easier retrieval. For more information on specific formats, see:</p>
<p><a href="../symbol-server-compatibility/">Symbol Server Compatibility</a></p>
<p>There are two kinds of identifiers:</p>
<ul>
<li><strong>Code Id:</strong> Native identifier of the actual binary (library or executable). Usually, this is a value stored in the header or computed from its contents.</li>
<li><strong>Debug Id:</strong> Identifier of the associated debug file on some platforms, or a mangled version of the code identifier on other platforms.</li>
</ul>
<p>To look up different symbol kinds, the symbol server uses the following process to determine the ID (see below for exact conversion algorithms):</p>
<ul>
<li><strong>MachO:</strong> Use the UUID which is stored interchangeably in <code>debug_id</code> and <code>code_id</code>. If one of these values is missing, it can be computed from the other. Primarily, the <code>code_id</code> should be used.</li>
<li><strong>ELF:</strong> Use the GNU build id which is given in the <code>code_id</code>. The <code>debug_id</code> can be computed from this <code>code_id</code>, but not the other way around. Thus, if the <code>code_id</code> is missing, lookups may not be possible.</li>
<li><strong>PE</strong>: Windows executables use a combination of timestamp and size fields to compute a <code>code_id</code>. It is mandatory, as it cannot be derived from the <code>debug_id</code>.</li>
<li><strong>PDB</strong>: Windows PDBs have their own <code>debug_id</code>, which can be read from the PDB or PE header. It is mandatory, as it cannot be derived from the <code>code_id</code>.</li>
<li><strong>Breakpad</strong>: Google Breakpad uses <code>debug_id</code> for all symbol kinds. If it is missing, it can be computed from the <code>code_id</code> if this is possible using the above rules.</li>
</ul>
<h2 id="symbol-precedence">Symbol Precedence</h2>
<p>Depending on the desired information and type of image, the Symbolicator
requests several files and chooses the best one. Note that the image type
depends on the platform, but there are multiple formats for debug information
files available.</p>
<p>The following is a table of what we initially deemed as ideal lookup strategy.
How we deviate from this in practice is documented separately.</p>
<h3 id="symbol-table">Symbol Table</h3>
<h2 id="platform-1-choice-2-choice-3-choice">Platform | 1. Choice    | 2. Choice    | 3. Choice</h2>
<p>MachO    | MachO (dSYM) | MachO (code) | Breakpad
ELF      | ELF (debug)  | ELF (code)   | Breakpad
PE       | PDB          | PE           | Breakpad</p>
<h3 id="debug-information">Debug Information</h3>
<h2 id="platform-1-choice-2-choice-3-choice_1">Platform | 1. Choice    | 2. Choice    | 3. Choice</h2>
<p>MachO    | MachO (dSYM) | Breakpad     | 
ELF      | ELF (debug)  | ELF (code)   | Breakpad
PE       | PDB          | Breakpad     | </p>
<h3 id="unwind-information">Unwind Information</h3>
<h2 id="platform-1-choice-2-choice">Platform    | 1. Choice    | 2. Choice</h2>
<p>MachO       | MachO (code) | Breakpad
ELF         | ELF (code)   | Breakpad
PE (32-bit) | PDB          | Breakpad
PE (64-bit) | PE           | Breakpad</p>
<h3 id="notes-on-implementation">Notes on implementation</h3>
<ul>
<li>Symbolicator downloads <em>all</em> filetypes in parallel and filters by whether
  symbolic says that a file has debug/unwind information. There is no special
  codepath for each table presented here, and especially not for each
  platform/filetype.</li>
</ul>
<p>This creates a few more downloads than what would be necessary for a specific
  task, but those should not matter considering that you e.g. will likely look
  into debug information very soon if you already look for unwind information.</p>
<ul>
<li>As a result of the previous point, Symbolicator does not differentiate
  between 32-bit and 64-bit platforms, meaning that even on 64-bit Windows it
  will attempt to look into the PDB to find relevant information. Again this
  should not matter in terms of correctness as it will still also
  unconditionally look into the PE and pick that if it's deemed to be be of
  better quality.</li>
</ul>
<h2 id="conversion-algorithms">Conversion Algorithms</h2>
<p>Some identifiers may be computed from others. See the following list for allowed non-lossy conversions in pseudocode:</p>
<ul>
<li>
<p><strong>MachO <code>code_id</code> ←→ <code>debug_id</code></strong></p>
<p><em>identity</em></p>
</li>
</ul>
<p><strong>Implementation note:</strong> Symbolicator implements this by using the code ID everywhere.</p>
<ul>
<li>
<p><strong>ELF <code>code_id</code> → <code>debug_id</code></strong></p>
<p>debug_id = code_id[0..16]</p>
<p>if object.little_endian {
    debug_id[0..4].reverse(); // uuid field 1
    debug_id[4..6].reverse(); // uuid field 2
    debug_id[6..8].reverse(); // uuid field 3
  }</p>
</li>
</ul>
<p><strong>Implementation note:</strong> This is not yet implemented (TODO)</p>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../symbol-server-compatibility/" class="btn btn-neutral float-right" title="Symbol Server Compatibility">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../caching/" class="btn btn-neutral" title="Internal Caching"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
      
        <span><a href="../caching/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../symbol-server-compatibility/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>
    <script>var base_url = '..';</script>
    <script src="../js/theme.js" defer></script>
      <script src="../search/main.js" defer></script>

</body>
</html>
